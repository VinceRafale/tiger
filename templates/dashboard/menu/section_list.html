{% extends 'dashboard/base.html' %}

{% block extrahead %}
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
<style>
div.sections {clear:right;}
ul.section {font-size:13px; border:1px solid gray;}
ul.section ul {margin-bottom:0;}
ul.section li {margin:0;}
li.section-header {color:white; background-color:#02405a; font-size:14px; padding:5px;}
li.menu-items li {
    height:22px;
    padding:1px;
    background-color:white;
}
li.menu-items li.shaded {background-color:#cde0e8;}
div.controls {float:right; clear:right;}
div.controls a {
    float:right; 
    display:block; 
    color:#4b4b4b; 
    padding:0 5px; 
    text-decoration:none;
    margin:1px 2px;
    font-size:12px;
}
div.section-controls a {
    border: 1px grey solid; 
    background-color:#dedede;
    -moz-border-radius:3px;
    -webkit-border-radius:3px;
}
li.menu-items div.controls a {
    height:16px;
    width:16px;
}
li.menu-items div.controls a.stock {
    width:auto;
    display:none;
}
li.menu-items div.controls a.out-of-stock {
    font-weight:bold;
    color:red;
    display:block;
}
</style>
{% endblock %}

{% block content %}
<h1>Menu management</h1>
<div class="grid_12 alpha omega">
    <a href="{% url dashboard_add_section %}">New menu section</a>
    <div class="sections">
    {% for section in sections %}
    <ul class="section" id="{{ section.id }}">
        <li class="section-header">
            <div class="controls section-controls">
                <a id="newItem" href="{% url dashboard_add_item %}?pk={{ section.id }}">New menu item</a>
                <a class="delete" href="{% url dashboard_delete_section section.id %}">Delete</a>
                <a href="{% url dashboard_edit_section section.id %}">Edit</a>
            </div>
            {{ section.name }}
        </li>
        <li class="menu-items">
            <ul>
            {% include 'dashboard/includes/item_list.html' %}
            </ul>
        </li>
    </ul>
    {% empty %}
        You have not created any menu sections. <a href="{% url dashboard_add_section %}">Create one now</a>
    {% endfor %}
    </div>
</div>
{% endblock %}

{% block js %}
<script type="text/javascript">
$(function () {
    $("li.menu-items ul").sortable({
        stop: function(event, ui) { 
            $.post("items/reorder/", $.param({
                item_ids: $(this).sortable('toArray')
            }, true));
            $(this).children().filter(":odd").addClass("shaded");
            $(this).children().filter(":even").removeClass("shaded");
        },
        cancel: "a,label"
    });
    $("div.sections").sortable({
        stop: function(event, ui) { 
            $.post("sections/reorder/", $.param({
                section_ids: $(this).sortable('toArray')
            }, true));
        },
        cancel: "li.menu-items,a"
    });
    $("a.delete").live("click", function () {
        h3Text = $(this).parent().hasClass("section-controls") ? "section" : "item";
        c = confirm("Are you sure you want to delete this " + h3Text + "? This action cannot be undone.");
        if (!c)
            return false;
    });
});
</script>
{% endblock %}
