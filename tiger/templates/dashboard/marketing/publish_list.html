{% extends 'dashboard/marketing/home.html' %}

{% block extrahead %}
{{ form.media }}
<style>
#published li {
    -webkit-border-radius:3px;
    -moz-border-radius:3px;
    border-radius:3px;
    background-color:white;
    margin-left:0;
    padding:4px;
}
#published li li {
    float: left; 
}
</style>
{% endblock %}

{% block body-class %}{{ block.super }} publish{% endblock %}

{% block h2 %}
Your published news items
{% endblock %}

{% block help %}
<p>Use this form to publish marketing materials on your site and Twitter, Facebook, e-mail (via MailChimp), and fax simultaneously.</p>
<p>You must have the respective accounts configured on the <a href="{% url dashboard_marketing %}">Integrations</a> screen to send through Twitter, Facebook, or MailChimp.</p>
{% endblock %}

{% block content %}
<a href="{% url dashboard_publish_new %}">New</a>
<ul id="published">
    {% for item in items %}
    <li>
        <span class="buttons">
            <a href="">delete</a>
            <a href="">edit</a>
        </span>
        <h3>{{ item.title }}</h3>
        <ul>
            <li>
                {% if item.visible %}
                <a href="{{ item.get_absolute_url }}">View on your site</a>
                {% else %}
                not published on your site
                {% endif %}
            </li> 
            <li>
                {% if item.twitter %}
                <a href="{{ item.twitter }}">On Twitter</a>
                {% else %}
                not published to Twitter
                {% endif %}
            </li> 
            <li>
                {% if item.facebook %}
                <a href="{{ item.facebook }}">On Facebook</a>
                {% else %}
                not published to Facebook
                {% endif %}
            </li> 
            <li>
                {% if item.mailchimp %}
                <a href="{{ item.mailchimp }}">Your MailChimp Campaign</a>
                {% else %}
                no MailChimp campaign created
                {% endif %}
            </li> 
            <li>
                {% with item.fax_count as fc %}
                Faxed to {{ fc }} recipient{{ fc|pluralize }}
                {% endwith %}
            </li> 
        </ul>
        <div class="clear"></div>
    </li>
    {% endfor %}
</ul>
{% endblock %}

{% block js %}
<script type="text/javascript">
$(function () {
    $("#id_pdf,#id_coupon,#id_fax_list").hide();
    $("#id_add_pdf,#id_add_coupon,#id_fax").click(function () {
        if ($(this).attr("checked")) {
            $(this).parent().next(":input").show();
        } else {
            $(this).parent().next(":input").hide();
        }
    });
    $("#id_coupon").change(function () {
        couponId = $(this).val();
        if (couponId) {
            $.get("fetch-coupon/", $.param({coupon: couponId}), function (data) {
               $("#id_title").val(data['boilerplate']); 
               $("#id_coupon").after('<label id="copy-coupon">Link to add coupon to an order: <input readonly value="' + data['short_url'] + '" /> This will automatically be added to Twitter and Facebook updates.</label>');
            }, "json");
        }
    });
    $("#id_body").keyup(function () {
        trgt = this;
        $.post("{% url dashboard_publish_preview %}", $.param({preview: $(trgt).val()}), function (data) {
            $("#editorPreview").html("<h1>" + $("#id_title").val() + "</h1>" + data);
        }, "html");
    });
    $("#id_title").keyup(function () {
        $("span.counter").text($(this).val().length);
    });
    $("#id_title").blur(function () {
        if ($("#editorPreview").find("h1").length) {
            $("#editorPreview h1").text($(this).val());
        } else {
            $("#editorPreview").prepend("<h1>" + $(this).val() + "</h1>");
        }
    });
});
</script>
{% endblock %}
